<!DOCTYPE html>
<html lang="he" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Wedding Elite | ×”×“×¨×š ×©×œ×›× ×œ×—×•×¤×” ××ª×—×™×œ×” ×›××Ÿ</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Assistant:wght@300;400;600;700;800&display=swap" rel="stylesheet">
    <style>
        body { font-family: 'Assistant', sans-serif; background: #f8fafc; padding-bottom: 100px; }
        .glass-card { background: rgba(255, 255, 255, 0.95); backdrop-filter: blur(12px); border-radius: 30px; border: 1px solid rgba(255,255,255,0.3); box-shadow: 0 10px 30px rgba(0,0,0,0.05); }
        .dark-stats { background: #1a2233; color: white; border-radius: 35px; }
        .tab-content { display: none; }
        .tab-content.active { display: block; animation: fadeIn 0.3s ease; }
        @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }
        .nav-active div { background: rgba(79, 70, 229, 0.2); transform: scale(1.1); }
        .nav-active span { color: white !important; }
        .chart-center { position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); text-align: center; }
    </style>
</head>
<body>

    <div id="hero-section" class="max-w-6xl mx-auto px-4 py-12 text-center">
        <h1 class="text-5xl md:text-7xl font-black text-slate-800 mb-6 tracking-tight">××ª×›× × ×™× ×—×ª×•× ×”?<br><span class="text-indigo-600">×ª×©×œ×˜×• ×‘××¡×¤×¨×™×.</span></h1>
        <p class="text-lg text-slate-500 max-w-2xl mx-auto mb-10 font-medium">×”××¤×œ×™×§×¦×™×” ×”×—×›××” ×œ× ×™×”×•×œ ×ª×§×¦×™×‘ ×•××©×™××•×ª. ×¤×©×•×˜, ××”×™×¨ ×•×‘×œ×™ ××§×¡×œ×™×.</p>
        <button onclick="scrollToApp()" class="bg-indigo-600 text-white px-10 py-5 rounded-2xl text-xl font-black shadow-2xl hover:bg-indigo-700 transition w-full md:w-auto">×”×ª×—×™×œ×• ×œ×ª×›× ×Ÿ ×‘×—×™× × ğŸ’</button>
    </div>

    <div id="app-anchor" class="max-w-6xl mx-auto px-4">
        <div id="tab-home" class="tab-content active">
            <div class="dark-stats p-10 mb-8 flex flex-col items-center relative">
                <p class="text-indigo-400 text-[10px] font-bold uppercase tracking-widest mb-2 text-center">×™×ª×¨×” ×œ×©×™××•×© ×—×•×¤×©×™</p>
                <h3 id="rem-budget" class="text-5xl font-black text-white mb-8">â‚ª0</h3>
                <div class="relative w-full max-w-[250px]">
                    <canvas id="mainChart"></canvas>
                    <div class="chart-center">
                        <p id="pct-val" class="text-4xl font-black">0%</p>
                        <p class="text-[8px] uppercase font-bold text-indigo-300">××•×›× ×•×ª</p>
                    </div>
                </div>
            </div>
            <div class="grid grid-cols-2 gap-4 mb-8">
                <div class="glass-card p-6 text-center">
                    <p class="text-gray-400 text-[10px] uppercase font-bold">×”×©×§×¢×” ×œ××•×¨×—</p>
                    <p id="guest-cost" class="text-xl font-bold text-indigo-600">â‚ª0</p>
                </div>
                <div class="glass-card p-6 text-center">
                    <p class="text-gray-400 text-[10px] uppercase font-bold">××•×¨×—×™×</p>
                    <input id="guest-count" type="number" onchange="updateUI()" class="bg-transparent text-xl font-bold text-center w-full outline-none" value="400">
                </div>
            </div>
        </div>

        <div id="tab-budget" class="tab-content space-y-4">
            <h2 class="text-2xl font-black text-slate-800 mb-6">×¤×™×¨×•×˜ ×ª×§×¦×™×‘</h2>
            <div class="glass-card p-6 mb-6 bg-slate-800 text-white">
                <p class="text-xs text-gray-400 mb-1">×”×’×“×¨×ª ×ª×§×¦×™×‘ ×™×¢×“</p>
                <div class="flex gap-2">
                    <input id="total-target" type="number" class="bg-transparent text-2xl font-bold w-full outline-none" placeholder="â‚ª0">
                    <button onclick="updateBudgetTotal()" class="bg-emerald-500 px-4 py-2 rounded-xl text-xs font-bold">×¢×“×›×Ÿ</button>
                </div>
            </div>
            <div id="cat-list" class="space-y-4"></div>
        </div>

        <div id="tab-tasks" class="tab-content">
            <h2 class="text-2xl font-black text-slate-800 mb-6 font-black italic uppercase italic tracking-tighter">×¦'×§-×œ×™×¡×˜ ××©×™××•×ª</h2>
            <div class="glass-card p-8 text-center text-gray-400">×”××©×™××•×ª ×©×œ×›× ×™×•×¤×™×¢×• ×›××Ÿ ×‘×§×¨×•×‘...</div>
        </div>

        <div id="tab-guests" class="tab-content">
            <h2 class="text-2xl font-black text-slate-800 mb-6 font-black italic uppercase italic tracking-tighter">×¨×©×™××ª ××•×–×× ×™×</h2>
            <div class="glass-card p-8 text-center text-gray-400">× ×™×”×•×œ ×”××•×¨×—×™× ×™×”×™×” ×–××™×Ÿ ×‘×’×¨×¡×” ×”×‘××”.</div>
        </div>
    </div>

    <div class="fixed bottom-6 left-1/2 -translate-x-1/2 w-[92%] max-w-md bg-[#1a2233]/95 backdrop-blur-xl rounded-[32px] py-3 px-6 shadow-2xl z-50 flex justify-between items-center border border-white/10 md:hidden">
        <button onclick="switchTab('tab-home')" id="nav-home" class="nav-item nav-active flex flex-col items-center gap-1 transition-all duration-300">
            <div class="p-2.5 rounded-2xl text-lg transition-all">ğŸ </div>
            <span class="text-[9px] font-bold text-gray-400">×¨××©×™</span>
        </button>
        <button onclick="switchTab('tab-budget')" id="nav-budget" class="nav-item flex flex-col items-center gap-1 transition-all duration-300">
            <div class="p-2.5 rounded-2xl text-lg transition-all">ğŸ’°</div>
            <span class="text-[9px] font-bold text-gray-400">×ª×§×¦×™×‘</span>
        </button>
        <button onclick="switchTab('tab-tasks')" id="nav-tasks" class="nav-item flex flex-col items-center gap-1 transition-all duration-300">
            <div class="p-2.5 rounded-2xl text-lg transition-all">âœ…</div>
            <span class="text-[9px] font-bold text-gray-400">××©×™××•×ª</span>
        </button>
        <button onclick="switchTab('tab-guests')" id="nav-guests" class="nav-item flex flex-col items-center gap-1 transition-all duration-300">
            <div class="p-2.5 rounded-2xl text-lg transition-all">ğŸ‘¥</div>
            <span class="text-[9px] font-bold text-gray-400">××•×¨×—×™×</span>
        </button>
    </div>

    <script>
        const API = "https://weddingplannerapp-i54n.onrender.com"; 
        let myChart;
        let localData = { spent: 0, total: 0 };
        
        const cats = [
            { name: '××•×œ× ×•×§×™×™×˜×¨×™× ×’', icon: 'ğŸ›ï¸', items: ['×× ×” ××‘×•×’×¨', '×¢×™×¦×•×‘', '×”×’×‘×¨×”'] },
            { name: '×¡×¤×§×™×', icon: 'ğŸ“·', items: ['DJ', '×¦×œ× ×¡×˜×™×œ×¡', '×¦×œ× ×•×™×“××•'] },
            { name: '×œ×•×§ ×•×¡×˜×™×™×œ', icon: 'ğŸ‘°', items: ['×©××œ×”', '×—×œ×™×¤×”', '××™×¤×•×¨ ×•×©×™×¢×¨'] }
        ];

        function switchTab(tabId) {
            // Hide all contents
            document.querySelectorAll('.tab-content').forEach(c => c.classList.remove('active'));
            // Deactivate all nav items
            document.querySelectorAll('.nav-item').forEach(n => n.classList.remove('nav-active'));
            
            // Show selected
            document.getElementById(tabId).classList.add('active');
            const navId = 'nav-' + tabId.split('-')[1];
            document.getElementById(navId).classList.add('nav-active');

            // Scroll to top of app
            if(window.innerWidth < 768) {
                document.getElementById('app-anchor').scrollIntoView({ behavior: 'smooth' });
            }
        }

        function scrollToApp() { switchTab('tab-home'); }

        async function refresh() {
            try {
                const res = await fetch(`${API}/budget/summary`);
                localData = await res.json();
                updateUI();
            } catch (e) { console.error("Sync error"); }
        }

        function updateUI() {
            const rem = localData.total - localData.spent;
            const guests = parseInt(document.getElementById('guest-count').value) || 1;
            document.getElementById('rem-budget').innerText = `â‚ª${rem.toLocaleString()}`;
            document.getElementById('pct-val').innerText = `${Math.round((localData.spent/localData.total)*100 || 0)}%`;
            document.getElementById('guest-cost').innerText = `â‚ª${Math.round(localData.spent/guests)}`;
            draw();
        }

        async function updateBudgetTotal() {
            const val = document.getElementById('total-target').value;
            await fetch(`${API}/budget/update_total?amount=${val}`, { method: 'POST' });
            refresh();
        }

        function draw() {
            const ctx = document.getElementById('mainChart').getContext('2d');
            if (myChart) myChart.destroy();
            myChart = new Chart(ctx, {
                type: 'doughnut',
                data: { datasets: [{ data: [localData.spent, Math.max(0, localData.total - localData.spent)], backgroundColor: ['#6366f1', 'rgba(255,255,255,0.05)'], borderWidth: 0, borderRadius: 10 }] },
                options: { cutout: '85%', plugins: { legend: { display: false } } }
            });
        }

        // Initialize App
        function initApp() {
            const container = document.getElementById('cat-list');
            cats.forEach(c => {
                container.innerHTML += `
                    <div class="glass-card p-6">
                        <div class="flex items-center gap-3 mb-4 font-bold text-slate-700">${c.icon} ${c.name}</div>
                        ${c.items.map(item => `
                            <div class="flex justify-between items-center py-2 border-t border-gray-100">
                                <span class="text-sm text-gray-500">${item}</span>
                                <input type="number" onblur="saveExp('${item}', this.value)" class="w-20 text-center font-bold text-indigo-600 outline-none" placeholder="â‚ª0">
                            </div>
                        `).join('')}
                    </div>
                `;
            });
            refresh();
        }

        async function saveExp(cat, val) {
            if(!val) return;
            await fetch(`${API}/budget/add`, {
                method: 'POST',
                headers: {'Content-Type': 'application/json'},
                body: JSON.stringify({category: cat, amount: val})
            });
            refresh();
        }

        initApp();
    </script>
</body>
</html>
