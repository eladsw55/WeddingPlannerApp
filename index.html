<!DOCTYPE html>
<html lang="he" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Wedding Elite | AI Wedding Manager</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.6.0/dist/confetti.browser.min.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Assistant:wght@300;400;600;700;800&display=swap" rel="stylesheet">
    <style>
        body { font-family: 'Assistant', sans-serif; background: #f8fafc; color: #1e293b; }
        .glass-card { background: rgba(255, 255, 255, 0.9); backdrop-filter: blur(10px); border-radius: 24px; border: 1px solid rgba(255,255,255,0.5); box-shadow: 0 4px 20px rgba(0,0,0,0.05); }
        .tab-btn.active { background: #4f46e5; color: white; box-shadow: 0 4px 12px rgba(79, 70, 229, 0.3); }
        .hidden { display: none; }
        .status-tag { font-size: 10px; font-weight: 800; padding: 2px 8px; border-radius: 999px; text-transform: uppercase; }
        .status-confirmed { background: #dcfce7; color: #166534; }
        .status-maybe { background: #fef9c3; color: #854d0e; }
        .status-declined { background: #fee2e2; color: #991b1b; }
    </style>
</head>
<body class="p-4 md:p-8 min-h-screen bg-slate-50">

    <div class="max-w-4xl mx-auto">
        <header class="flex justify-between items-center mb-8">
            <h1 class="text-3xl font-black text-slate-800 tracking-tighter">Wedding<span class="text-indigo-600">Elite</span></h1>
            <div id="mini-summary" class="text-left text-xs font-bold text-slate-400">
                ×™×ª×¨×”: <span id="header-rem" class="text-indigo-600">â‚ª0</span>
            </div>
        </header>

        <div class="flex gap-2 mb-8 bg-slate-200/50 p-1.5 rounded-2xl">
            <button onclick="switchTab('budget-section')" id="btn-budget" class="tab-btn active flex-1 py-3 rounded-xl font-bold transition-all">ğŸ’° ×ª×§×¦×™×‘</button>
            <button onclick="switchTab('guests-section')" id="btn-guests" class="tab-btn flex-1 py-3 rounded-xl font-bold transition-all">ğŸ‘¥ ××•×¨×—×™×</button>
        </div>

        <div id="budget-section" class="space-y-6">
            <div class="glass-card p-6 md:p-8 text-center bg-slate-900 text-white border-none shadow-2xl relative overflow-hidden">
                <div class="relative z-10">
                    <p class="text-indigo-300 text-[10px] font-bold uppercase tracking-widest mb-2">×™×ª×¨×” ×œ× ×™×”×•×œ</p>
                    <h2 id="rem-budget" class="text-5xl font-black mb-6 tracking-tight">â‚ª0</h2>
                    <div class="flex gap-4 justify-center items-center">
                        <div class="text-center">
                            <p id="pct-val" class="text-2xl font-black">0%</p>
                            <p class="text-[8px] uppercase text-slate-400 font-bold">× ×•×¦×œ ××”×ª×§×¦×™×‘</p>
                        </div>
                        <div class="h-8 w-[1px] bg-slate-700"></div>
                        <div class="text-center">
                            <p id="total-val" class="text-2xl font-black">â‚ª0</p>
                            <p class="text-[8px] uppercase text-slate-400 font-bold">×ª×§×¦×™×‘ ×™×¢×“</p>
                        </div>
                    </div>
                </div>
            </div>
            
            <div id="cat-list" class="space-y-4">
                </div>
        </div>

        <div id="guests-section" class="hidden space-y-6">
            <div class="grid grid-cols-3 gap-4 mb-6">
                <div class="glass-card p-4 text-center">
                    <p id="stat-confirmed" class="text-2xl font-black text-emerald-600">0</p>
                    <p class="text-[9px] font-bold text-slate-400 uppercase">××’×™×¢×™×</p>
                </div>
                <div class="glass-card p-4 text-center">
                    <p id="stat-maybe" class="text-2xl font-black text-amber-600">0</p>
                    <p class="text-[9px] font-bold text-slate-400 uppercase">××•×œ×™</p>
                </div>
                <div class="glass-card p-4 text-center">
                    <p id="stat-total" class="text-2xl font-black text-slate-800">0</p>
                    <p class="text-[9px] font-bold text-slate-400 uppercase">×¡×š ×”×›×œ</p>
                </div>
            </div>

            <div class="glass-card p-6 border-indigo-100 bg-white">
                <h3 class="font-bold text-slate-800 mb-4 flex items-center gap-2">
                    <span>â• ×”×•×¡×¤×ª ××•×¨×—/××©×¤×—×”</span>
                </h3>
                <div class="grid grid-cols-2 gap-3 mb-4">
                    <input id="guest-name" type="text" placeholder="×©× ×”××•×¨×—" class="col-span-2 p-3 bg-slate-50 rounded-xl outline-none focus:ring-2 ring-indigo-500 transition">
                    <input id="guest-qty" type="number" placeholder="×›××•×ª" class="p-3 bg-slate-50 rounded-xl outline-none" value="1">
                    <select id="guest-side" class="p-3 bg-slate-50 rounded-xl outline-none">
                        <option value="×—×ª×Ÿ">×¦×“ ×—×ª×Ÿ</option>
                        <option value="×›×œ×”">×¦×“ ×›×œ×”</option>
                        <option value="××©×•×ª×£">××©×•×ª×£</option>
                    </select>
                </div>
                <button onclick="addGuest()" class="w-full bg-indigo-600 text-white py-3 rounded-xl font-bold shadow-lg hover:bg-indigo-700 transition">×”×•×¡×£ ×œ×¨×©×™××” âœ¨</button>
            </div>

            <div id="guest-list" class="space-y-3">
                </div>
        </div>
    </div>

    <script>
        const API = "https://weddingplannerapp-i54n.onrender.com"; // ×•×•×“× ×©×–×” ×”-URL ×©×œ×š
        let localData = { spent: 0, total: 0, guests: [] };

        function switchTab(id) {
            document.getElementById('budget-section').classList.add('hidden');
            document.getElementById('guests-section').classList.add('hidden');
            document.getElementById('btn-budget').classList.remove('active');
            document.getElementById('btn-guests').classList.remove('active');
            
            document.getElementById(id).classList.remove('hidden');
            if(id === 'budget-section') document.getElementById('btn-budget').classList.add('active');
            if(id === 'guests-section') document.getElementById('btn-guests').classList.add('active');
        }

        async function refreshData() {
            try {
                const bRes = await fetch(`${API}/budget/summary`);
                const budget = await bRes.json();
                
                const gRes = await fetch(`${API}/guests`);
                const guests = await gRes.json();
                
                localData.spent = budget.spent;
                localData.total = budget.total;
                localData.guests = guests;
                
                updateUI();
            } catch(e) { console.error("Sync error", e); }
        }

        function updateUI() {
            // Update Budget UI
            const rem = localData.total - localData.spent;
            document.getElementById('rem-budget').innerText = `â‚ª${rem.toLocaleString()}`;
            document.getElementById('header-rem').innerText = `â‚ª${rem.toLocaleString()}`;
            document.getElementById('total-val').innerText = `â‚ª${localData.total.toLocaleString()}`;
            const pct = localData.total > 0 ? Math.round((localData.spent/localData.total)*100) : 0;
            document.getElementById('pct-val').innerText = `${pct}%`;

            // Update Guests UI
            let confirmed = 0, maybe = 0, total = 0;
            const list = document.getElementById('guest-list');
            list.innerHTML = "";
            
            localData.guests.forEach(g => {
                total += g.count;
                if(g.status === 'confirmed') confirmed += g.count;
                if(g.status === 'maybe') maybe += g.count;
                
                list.innerHTML += `
                    <div class="glass-card p-4 flex justify-between items-center bg-white">
                        <div>
                            <p class="font-bold text-slate-800">${g.name} <span class="text-indigo-500 text-sm">(${g.count})</span></p>
                            <p class="text-[10px] text-slate-400 font-bold uppercase">${g.side}</p>
                        </div>
                        <div class="flex items-center gap-3">
                            <span class="status-tag status-${g.status}">${g.status === 'confirmed' ? '××’×™×¢' : g.status === 'maybe' ? '××•×œ×™' : '×œ× ××’×™×¢'}</span>
                            <button onclick="deleteGuest(${g.id})" class="text-slate-300 hover:text-red-500 transition">ğŸ—‘ï¸</button>
                        </div>
                    </div>
                `;
            });

            document.getElementById('stat-confirmed').innerText = confirmed;
            document.getElementById('stat-maybe').innerText = maybe;
            document.getElementById('stat-total').innerText = total;
        }

        async function addGuest() {
            const name = document.getElementById('guest-name').value;
            const qty = parseInt(document.getElementById('guest-qty').value);
            const side = document.getElementById('guest-side').value;
            
            if(!name) return alert("×× × ×”×–×Ÿ ×©× ××•×¨×—");
            
            await fetch(`${API}/guests/add`, {
                method: 'POST',
                headers: {'Content-Type': 'application/json'},
                body: JSON.stringify({ name, count: qty, status: 'confirmed', side })
            });
            
            document.getElementById('guest-name').value = "";
            refreshData();
            triggerConfetti();
        }

        async function deleteGuest(id) {
            if(!confirm("×œ×”×¡×™×¨ ××ª ×”××•×¨×—?")) return;
            await fetch(`${API}/guests/${id}`, { method: 'DELETE' });
            refreshData();
        }

        function triggerConfetti() {
            confetti({ particleCount: 100, spread: 70, origin: { y: 0.6 } });
        }

        // Initial Load
        refreshData();
    </script>
</body>
</html>
